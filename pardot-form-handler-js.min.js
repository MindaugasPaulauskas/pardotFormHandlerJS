/*! pardotFormHandlerJS v.0.2.0 | (c) 2024 Mindaugas Paulauskas | https://github.com/MindaugasPaulauskas/pardotFormHandlerJS/LICENSE */
!function(e){function r(n,e){var s=this,o=(this.form=n,this.settings=JSON.parse(JSON.stringify(S)),this.setSettings=function(e){for(key in e)void 0!==s.settings[key]&&(s.settings[key]=e[key]);return s},this.setSettings(e),this.currentCallbackId=!1,this.callbacks={onBeforeSubmit:function(e,t){return!0},onSubmit:function(e){},onCancel:function(e){},onSuccess:function(e){},onError:function(e){},onComplete:function(e){}},this.onBeforeSubmit=function(r){return s.callbacks.onBeforeSubmit=function(e,t){return r(e,t)},s},this.onSubmit=function(t){return s.callbacks.onSubmit=function(e){return t(e)},s},this.onCancel=function(t){return s.callbacks.onCancel=function(e){return t(e)},s},this.onSuccess=function(t){return s.callbacks.onSuccess=function(e){return t(e)},s},this.onError=function(t){return s.callbacks.onError=function(e){return t(e)},s},this.onComplete=function(t){return s.callbacks.onComplete=function(e){return t(e)},s},!(this.destroy=function(){return s.form.removeEventListener("submit",t),s.form.removeEventListener(l,r),s.form.removeEventListener(c,i),F(s.currentCallbackId,"form destroyed"),s})),t=(this.pause=function(){return o=!0,s},this.unpause=function(e){return!1!==o&&((o=!1)===e?(s.formValues=!1,y(s.form,s.settings)):(void 0!==e&&!0!==e&&(s.formValues=e),a())),s},this.formValues=!1,function(e){var t,r=e.target;u(r)&&(e.preventDefault(),e=f(r),C(r),o=!1,t=s.callbacks.onBeforeSubmit(e,r),!1!==s.currentCallbackId&&x(s.currentCallbackId),!1===t?(s.formValues=!1,o=!1):(v(r,s.settings),s.formValues=e=void 0!==t&&!0!==t?t:e,!0!==o&&a()))}),a=function(){var e,t,r,o=s.formValues;!1!==o&&(s.formValues=!1,t=s.form.getAttribute("action"),!1!==s.settings.actionUrl&&(t=s.settings.actionUrl),e=h(s.form),r=m(o),E[e]={id:e,formDom:n,pardotForm:s,url:t=t+"?callback="+e+"&"+r,values:o,scriptDom:!1},s.currentCallbackId=e,r=document.createElement("script"),document.body.appendChild(r),r.src=t,E[e].scriptDom=r,s.callbacks.onSubmit({submit:E[e],result:!1}),s.settings.timeout)&&setTimeout(function(){M(E[e])},s.settings.timeout)},r=(n.addEventListener("submit",t),function(e){k(n,e.detail),y(n),s.callbacks.onError(e.detail),s.currentCallbackId=!1,s.callbacks.onComplete(e.detail)}),i=(n.addEventListener(l,r),function(e){k(n,e.detail),y(n),s.callbacks.onSuccess(e.detail),s.currentCallbackId=!1,s.callbacks.onComplete(e.detail)});n.addEventListener(c,i)}var t="pardotFormHandlerJS",l=t+".Error",c=t+".Success",o="pardot-form-handler-js--",n=o+"jsonp-callback",s=o+"overlay",d=o+"message",g=d+"-container",o=o+"loader-spin",a=function(e){for(var t=0,r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t},u=function(e){return null!==e&&"object"==typeof e&&"FORM"===e.nodeName&&void 0!==e.elements},f=function(e){function t(e,t,r){switch(typeof e[t]){case"undefined":e[t]=r;break;case"string":e[t]=[e[t]],e[t].push(r);break;case"object":e[t].push(r)}return e}var r,o,n,s={};if(!u(e))return!1;for(r=0;r<e.elements.length;r++)if((n=e.elements[r]).name&&!n.disabled)switch(n.type){case"submit":case"button":case"reset":case"file":break;case"select-multiple":for(o=0;o<e.elements[r].options.length;o++)n.options[o].selected&&(s=t(s,n.name,n.options[o].value));break;case"checkbox":case"radio":if(!n.checked)break;default:s=t(s,n.name,n.value)}return s},m=function(e){function t(e){return encodeURIComponent(e)}var r,o=[];for(r in e)if("string"==typeof e[r])o[o.length]=t(r)+"="+t(e[r]);else if("object"==typeof e[r])for(i=0;i<e[r].length;i++)o[o.length]=t(r)+"="+t(e[r][i]);return o.join("&").replace(/%20/g,"+")},b=function(e){return m(f(e))},p=function(e){for(var t="",r=0;r<e;r++)t+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(36*Math.random()));return t},h=function(e){var t=[n,(new Date).getTime().toString(36),p(8),a(b(e)).toString(35).replace("-","z")].join("-");return t=void 0!==E[t]?h(e):t},v=function(e,t){var r;!0===t.showLoadingOverlay&&((r=document.createElement("div")).className=s,r.style.position="absolute",r.style.top="0",r.style.bottom="0",r.style.left="0",r.style.right="0",r.style.background=t.loadingOverlayBgColor,r.innerHTML=t.loadingOverlayInnerHtml,e.appendChild(r))},y=function(e){for(var t=e.querySelectorAll("."+s),r=0;r<t.length;r++)t[r].parentNode.removeChild(t[r])},k=function(e,t){var r=t.submit.pardotForm.settings,o=!1,n=r.messageErrorBgColor,s=!1,a="#495467",i="#fff",l=r.messagePadding,c=r.messageBorderRadius,u=r.messageMargin,f=d,m=!1;!0===r.showFormMessaging&&(!0===t.result.errors||"true"===t.result.errors?(o=!0,f+=" errors",a=n,i=r.messageErrorTxtColor):(f+=" success",a=r.messageSuccessBgColor,i=r.messageSuccessTxtColor,s=r.successMessage),"string"==typeof t.result.errorMessage?s=(s="~~~"===(s=t.result.errorMessage).substr(s.length-3)?s.substr(0,s.length-3):s).replaceAll("~~~","<br>"):!0===o&&(s=r.defaultErrorMessage),s&&((m=document.createElement("div")).className=f,m.style.background=a,m.style.padding=l,m.style.borderRadius=c,m.style.margin=u,m.style.color=i,m.innerHTML=s,(n=null===(n=e.querySelector("."+g))?e:n).insertBefore(m,n.firstChild)),!1===o)&&!0===t.submit.pardotForm.settings.resetFormAfterSuccess&&t.submit.formDom.reset()},C=function(e,t){for(var r=e.querySelectorAll("."+d),o=0;o<r.length;o++)r[o].parentNode.removeChild(r[o])},S={actionUrl:!1,successMessage:"Success! Thank you for submission.",resetFormAfterSuccess:!0,defaultErrorMessage:"Submission failed! Please enter required information.",timeout:5e3,timeoutMessage:"Oops! Request has timed out. Please try again later.",showLoadingOverlay:!0,loadingOverlayBgColor:"rgba(0,0,0,0.1)",loadingOverlayInnerHtml:"<style>@keyframes "+o+"{100%{transform:rotate(360deg);}}</style><div style='position:absolute;top:50%;left:50%;width:50px;height:50px;box-sizing:border-box;margin:-25px 0 0 -25px;border:#fff 4px solid;border-radius:25px;animation:"+o+" 3s linear infinite;border-color:#666 transparent transparent;'></div>",showFormMessaging:!0,messageErrorBgColor:"#dd1a21",messageErrorTxtColor:"#fff",messageSuccessBgColor:"#147f3c",messageSuccessTxtColor:"#fff",messagePadding:"4px",messageMargin:"0 0 4px",messageBorderRadius:"4px"},E=[],M=function(e){var t,e=w(e);e&&(t={submit:E[e],result:{errors:!0}},"string"==typeof E[e].pardotForm.settings.timeoutMessage&&(t.result.errorMessage=E[e].pardotForm.settings.timeoutMessage),k(E[e].formDom,t),y(E[e].formDom),E[e].pardotForm.callbacks.onError(t),E[e].pardotForm.callbacks.onComplete(t),F(e,"timed out"))},x=function(e){e=w(e);e&&(E[e].pardotForm.callbacks.onCancel({submit:E[e],result:!1}),F(e,"canceled"))},F=function(e,t){var r,e=w(e);e&&((r=E[e].scriptDom).parentNode.removeChild(r),E[e]=t)},w=function(e){return void 0!==(e="string"==typeof e?E[e]:e)&&"string"==typeof e.id&&e.id},o={setupForm(e,t){if(u(e))return new r(e,t)},callback(e){var t,r=c;if(void 0!==e){void 0===e.errors||!0!==e.errors&&"true"!==e.errors||(r=l);var o,n=!1;if("string"==typeof e.callback)n=e.callback;else{if(void 0===(o=document.currentScript))return;o=o.getAttribute("src"),o=new URL(o),n=new URLSearchParams(o.search).get("callback")}n&&E[n]&&(o=E[n].formDom)&&(t=E[n],o.dispatchEvent(new CustomEvent(r,{bubbles:!0,detail:{submit:t,result:e}})),F(n,r))}}};"object"==typeof e&&void 0===e[t]&&(e[t]=o)}(this);
