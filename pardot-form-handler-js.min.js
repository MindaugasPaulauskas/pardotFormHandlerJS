/*! pardotFormHandlerJS v.0.1.0 | (c) 2024 Mindaugas Paulauskas | https://github.com/MindaugasPaulauskas/pardotFormHandlerJS/LICENSE */
!function(e){var l={hashCode:function(e){for(var r=0,t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r},isForm:function(e){return"object"==typeof e&&"FORM"===e.nodeName&&void 0!==e.elements},getFormValues:function(e){function r(e,r,t){switch(typeof e[r]){case"undefined":e[r]=t;break;case"string":e[r]=[e[r]],e[r].push(t);break;case"object":e[r].push(t)}return e}var t,s,a,o=[];if(!this.isForm(e))return!1;for(t=0;t<e.elements.length;t++)if((a=e.elements[t]).name&&!a.disabled)switch(a.type){case"submit":case"button":case"reset":case"file":break;case"select-multiple":for(s=0;s<e.elements[t].options.length;s++)a.options[s].selected&&(o=r(o,a.name,a.options[s].value));break;case"checkbox":case"radio":a.checked&&(o=r(o,a.name,a.value));break;default:o=r(o,a.name,a.value)}return o},serializeFormValues:function(e){function r(e,r,t){return r=encodeURIComponent(r),r=(r+="=")+encodeURIComponent(t),e[e.length]=r,e}var t,s=[];for(t in e)if("string"==typeof e[t])s=r(s,t,e[t]);else if("object"==typeof e[t])for(i=0;i<e[t].length;i++)s=r(s,t,e[t][i]);return s.join("&").replace(/%20/g,"+")},serializeForm:function(e){e=this.getFormValues(e);return this.serializeFormValues(e)},getRandomChars:function(e){for(var r="",t=0;t<e;t++)r+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(36*Math.random()));return r},buildCallbackId:function(e,r){var t=["pardot-form-handler-js--jsonp-callback",(new Date).getTime().toString(36),this.getRandomChars(8),this.hashCode(this.serializeForm(r)).toString(35).replace("-","z")].join("-");return t=void 0!==e.callbackList[t]?this.buildCallbackId(e,r):t},addLoadingOverlay:function(e,r){var t;!0===r.showLoadingOverlay&&((t=document.createElement("div")).className="pardot-form-handler-js--overlay",t.style.position="absolute",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.background=r.loadingOverlayBgColor,t.innerHTML=r.loadingOverlayInnerHtml,e.appendChild(t))},removeLoadingOverlay:function(e){for(var r=e.querySelectorAll(".pardot-form-handler-js--overlay"),t=0;t<r.length;t++)r[t].parentNode.removeChild(r[t])},addFormMessaging:function(e,r){var t,s=r.submit.pardotForm.settings,a=!1,o=s.messageErrorBgColor,n=!1,i="#495467",l=s.messagePadding,c=s.messageBorderRadius,u=s.messageMargin,d="pardot-form-handler-js--message";!0===s.showFormMessaging&&(!0===r.result.errors||"true"===r.result.errors?(a=!0,d+=" errors",i=o):(d+=" success",i=s.messageSuccessBgColor,void 0!==r.submit&&void 0!==r.submit.pardotForm&&void 0!==r.submit.pardotForm.settings&&void 0!==r.submit.pardotForm.settings.successMessage&&(n=r.submit.pardotForm.settings.successMessage)),void 0!==r.result.errorMessage?"string"==typeof(n=r.result.errorMessage)&&(n=(n="~~~"===n.substr(n.length-3)?n.substr(0,n.length-3):n).replaceAll("~~~","<br>")):!0===a&&void 0!==r.submit&&void 0!==r.submit.pardotForm&&void 0!==r.submit.pardotForm.settings&&"string"!=typeof r.submit.pardotForm.settings.errorMessage&&(n=r.submit.pardotForm.settings.defaultErrorMessage),n&&((t=document.createElement("div")).className=d,t.style.background=i,t.style.padding=l,t.style.borderRadius=c,t.style.margin=u,t.style.color="#fff",t.innerHTML=n),!1===a&&!0===r.submit.pardotForm.settings.resetFormAfterSuccess&&r.submit.formDom.reset(),(o=null===(o=e.querySelector(".pardot-form-handler-js--message-container"))?e:o).insertBefore(t,o.firstChild))},removeFormMessaging:function(e,r){for(var t=e.querySelectorAll(".pardot-form-handler-js--message"),s=0;s<t.length;s++)t[s].parentNode.removeChild(t[s])}},c={defaultSettings:{actionUrl:!1,successMessage:"Success! Thank you for submission.",resetFormAfterSuccess:!0,defaultErrorMessage:"Submission failed! Please enter required information.",timeout:5e3,timeoutMessage:"Ops! Request has timed out. Please try again later.",showLoadingOverlay:!0,loadingOverlayBgColor:"rgba(0,0,0,0.1)",loadingOverlayInnerHtml:"<style>@keyframes pardot-form-handler-js--loader-spin{100%{transform:rotate(360deg);}}</style><div style='position:absolute;top:50%;left:50%;width:50px;height:50px;box-sizing:border-box;margin:-25px 0 0 -25px;border:#fff 4px solid;border-radius:25px;animation:pardot-form-handler-js--loader-spin 3s linear infinite;border-color:#666 rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);'></div>",showFormMessaging:!0,messageErrorBgColor:"#dd1a21",messageErrorTxtColor:"#fff",messageSuccessBgColor:"#147f3c",messageSuccessTxtColor:"#fff",messagePadding:"4px",messageMargin:"0 0 4px",messageBorderRadius:"4px"},callbackList:[],constructors:{PardotForm:function(o,r,e){var n=this,t=(this.form=r,this.settings=JSON.parse(JSON.stringify(c.defaultSettings)),this.setSettings=function(e){for(key in e)void 0!==n.settings[key]&&(n.settings[key]=e[key]);return n},this.setSettings(e),this.currentCallbackId=!1,this.callbacks={onBeforeSubmit:function(e,r){return!0},onSubmit:function(e){},onCancel:function(e){},onSuccess:function(e){},onError:function(e){},onComplete:function(e){}},this.onBeforeSubmit=function(t){return n.callbacks.onBeforeSubmit=function(e,r){return t(e,r)},n},this.onSubmit=function(r){return n.callbacks.onSubmit=function(e){return r(e)},n},this.onCancel=function(r){return n.callbacks.onCancel=function(e){return r(e)},n},this.onSuccess=function(r){return n.callbacks.onSuccess=function(e){return r(e)},n},this.onError=function(r){return n.callbacks.onError=function(e){return r(e)},n},this.onComplete=function(r){return n.callbacks.onComplete=function(e){return r(e)},n},this.destroy=function(){return n.form.removeEventListener("submit",t),n.form.removeEventListener("pardotFormHandlerJS.Error",s),n.form.removeEventListener("pardotFormHandlerJS.Success",a),c.clearCallback(n.currentCallbackId,"form destroyed"),n},function(e){var r,t,s,a=e.target;l.isForm(a)&&(e.preventDefault(),e=a.getAttribute("action"),!1!==n.settings.actionUrl&&(e=n.settings.actionUrl),r=l.getFormValues(a),!1!==(s=n.callbacks.onBeforeSubmit(r,a)))&&(void 0!==s&&!0!==s&&(r=s),!1!==n.currentCallbackId&&o.cancelCallback(n.currentCallbackId),s=l.serializeFormValues(r),t=l.buildCallbackId(o,a),o.callbackList[t]={id:t,formDom:a,pardotForm:n,url:e=e+"?callback="+t+"&"+s,values:r,scriptDom:!1},n.currentCallbackId=t,s=document.createElement("script"),document.body.appendChild(s),s.src=e,o.callbackList[t].scriptDom=s,l.removeFormMessaging(a),l.addLoadingOverlay(a,n.settings),n.callbacks.onSubmit({submit:o.callbackList[t],result:!1}),n.settings.timeout)&&setTimeout(function(){o.timeoutCheck(o.callbackList[t])},n.settings.timeout)}),s=(r.addEventListener("submit",t),function(e){l.addFormMessaging(r,e.detail),l.removeLoadingOverlay(r),n.callbacks.onError(e.detail),n.currentCallbackId=!1,n.callbacks.onComplete(e.detail)}),a=(r.addEventListener("pardotFormHandlerJS.Error",s),function(e){l.addFormMessaging(r,e.detail),l.removeLoadingOverlay(r),n.callbacks.onSuccess(e.detail),n.currentCallbackId=!1,n.callbacks.onComplete(e.detail)});r.addEventListener("pardotFormHandlerJS.Success",a)}},callback(e){var r,t="pardotFormHandlerJS.Success";if(void 0!==e){void 0===e.errors||!0!==e.errors&&"true"!==e.errors||(t="pardotFormHandlerJS.Error");var s,a=!1;if("string"==typeof e.callback)a=e.callback;else{if(void 0===(s=document.currentScript))return;s=s.getAttribute("src"),s=new URL(s),a=new URLSearchParams(s.search).get("callback")}a&&this.callbackList[a]&&(s=this.callbackList[a].formDom)&&(r=this.callbackList[a],s.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:{submit:r,result:e}})),this.clearCallback(a,t))}},timeoutCheck(e){var r,e=c.getCallbackIdFromList(e);e&&(r={submit:c.callbackList[e],result:{errors:!0}},"string"==typeof c.callbackList[e].pardotForm.settings.timeoutMessage&&(r.result.errorMessage=c.callbackList[e].pardotForm.settings.timeoutMessage),l.addFormMessaging(c.callbackList[e].formDom,r),l.removeLoadingOverlay(c.callbackList[e].formDom),c.callbackList[e].pardotForm.callbacks.onError(r),c.callbackList[e].pardotForm.callbacks.onComplete(r),c.clearCallback(e,"timed out"))},cancelCallback(e){e=c.getCallbackIdFromList(e);e&&(c.callbackList[e].pardotForm.callbacks.onCancel({submit:c.callbackList[e],result:!1}),c.clearCallback(e,"canceled"))},clearCallback(e,r){var t,e=c.getCallbackIdFromList(e);e&&((t=this.callbackList[e].scriptDom).parentNode.removeChild(t),c.callbackList[e]=r)},getCallbackIdFromList(e){var r;return"string"==typeof e&&(r=e,e=this.callbackList[r]),void 0!==e&&"string"==typeof e.id&&e.id},setupForm(e,r){if(l.isForm(e))return new this.constructors.PardotForm(this,e,r)}},r={setupForm(e,r){return c.setupForm(e,r)},callback(e){return c.callback(e)}};"object"==typeof e&&(e.pardotFormHandlerJS=r)}(this);
